# Pink Reader PWA

美しく機能豊富なプログレッシブウェブアプリ（PWA）で、PDFの閲覧、画像の表示、動画の再生が可能です。元々はiPadOS SwiftUIアプリケーションから移植されたPink Reader PWAは、オリジナルのすべての機能を維持しながら、クロスプラットフォーム対応を実現しています。

![Pink Reader PWA](https://via.placeholder.com/800x400/FFEAEF/4D4D4D?text=Pink+Reader+PWA)

## 🌸 機能

### 📚 マルチフォーマット対応
- **PDFドキュメント**: ページナビゲーションとズーム機能付きの本格的PDFビューア
- **画像**: ズームとパン操作可能な高解像度画像ビューア
- **動画**: シーク操作と再生位置保存機能付きカスタム動画プレイヤー

### 🎨 美しいピンクテーマ
- 桜にインスパイアされたエレガントなピンクカラースキーム
- デスクトップ、タブレット、モバイルで動作するレスポンシブデザイン
- 滑らかなアニメーションとトランジション
- ダークモード対応（システム設定に準拠）

### 📱 プログレッシブウェブアプリ
- あらゆるデバイス（iOS、Android、Windows、macOS、Linux）にインストール可能
- サービスワーカーキャッシュによるオフライン機能
- ネイティブアプリのような体験
- サポートされている環境でのファイルシステム統合

### 🗂️ ファイル管理
- ドラッグ&ドロップによるファイルインポート
- 自動サムネイル生成
- IndexedDBを使用したローカルストレージ
- タブとサイドバーによるファイル整理
- 検索とフィルター機能

### 🔧 高度な機能
- **PDF**: ページナビゲーション、ズーム、見開きモード、位置保存
- **画像**: ズーム、パン、ピンチズーム、ダブルタップでフィット
- **動画**: カスタムコントロール、シークバー、再生/一時停止、位置保存
- パワーユーザー向けキーボードショートカット
- ファイル操作用コンテキストメニュー

## 🚀 クイックスタート

### インストール

1. **直接使用**: モダンなウェブブラウザで`index.html`を開くだけ
2. **ウェブサーバー**: 任意のウェブサーバーでファイルを配信（完全なPWA機能には推奨）
3. **アプリとしてインストール**: ブラウザの「アプリをインストール」または「ホーム画面に追加」機能を使用

### ウェブサーバーのセットアップ

```bash
# Python（Python 3）を使用
python -m http.server 8000

# Node.js http-serverを使用
npx http-server -p 8000

# Live Server（VS Code拡張機能）を使用
# index.htmlを右クリックして「Open with Live Server」を選択
```

その後、`http://localhost:8000`にアクセス

### ブラウザ互換性

- ✅ Chrome 80+（推奨）
- ✅ Firefox 75+
- ✅ Safari 13+
- ✅ Edge 80+

## 📖 使用ガイド

### ファイルの追加

#### 方法1: ドラッグ&ドロップ
1. ファイルエクスプローラーからPDF、画像、または動画ファイルをドラッグ
2. Pink Readerウィンドウの任意の場所にドロップ
3. ファイルが自動的にインポートされ、サムネイルが生成されます

#### 方法2: ファイルピッカー
1. サイドバーの**+**ボタンをクリック
2. ファイルダイアログからファイルを選択
3. 複数のファイルを一度に選択可能

#### 方法3: キーボードショートカット
- `Ctrl+O`（Macでは`Cmd+O`）を押してファイルダイアログを開く

### ファイルのナビゲーション

#### サイドバー
- **グリッドビュー**: インポートされたすべてのファイルのビジュアルサムネイル
- **クリック**: ファイルを選択して表示
- **右クリック**: ファイル操作用のコンテキストメニューにアクセス

#### タブ
- **タブバー**: 開いているすべてのファイルをタブとして表示
- **クリック**: ファイル間を素早く切り替え
- **水平スクロール**: 多数の開いているファイル間をナビゲート

#### キーボードナビゲーション
- `Tab`: 次のファイル
- `Shift+Tab`: 前のファイル
- `Ctrl+W`: 現在のファイルを削除
- `Ctrl+B`: サイドバーの表示/非表示切り替え

### PDFビューア

#### ナビゲーション
- **矢印キー**: 前/次のページ
- **ページスライダー**: 特定のページにジャンプ
- **Home/End**: 最初/最後のページ
- **マウスホイール**: ズームイン/アウト
- **クリック&ドラッグ**: ドキュメント内をパン

#### コントロール
- **◀/▶**: 前/次のページボタン
- **📄/📖**: シングル/見開きページモードの切り替え
- **スライダー**: 任意のページに素早くジャンプ

#### キーボードショートカット
- `左/右矢印`: ページをナビゲート
- `Home/End`: 最初/最後のページ
- `+/-`: ズームイン/アウト
- `0`: ズームリセット

### 画像ビューア

#### ズーム&パン
- **マウスホイール**: ズームイン/アウト
- **クリック&ドラッグ**: 画像内をパン
- **ダブルクリック**: 画面フィットと2倍ズーム間の切り替え
- **ピンチ**: タッチデバイスでのズーム

#### コントロール
- **🔍+**: ズームイン
- **🔍-**: ズームアウト
- **🔄**: 画面フィットにリセット

#### キーボードショートカット
- `+/-`: ズームイン/アウト
- `0`: ズームリセット
- `F`: 画面フィット

### 動画プレイヤー

#### 再生コントロール
- **▶️/⏸️**: 再生/一時停止
- **⏪/⏩**: 10秒戻る/進む
- **シークバー**: 任意の位置にジャンプ

#### 機能
- **位置保存**: 再生位置を自動的に保存・復元
- **カスタムコントロール**: 常に表示、Pink Readerテーマのコントロール
- **時間表示**: 現在時間と総再生時間
- **フルスクリーン**: 動画をダブルクリックまたは`F`キーを押す

#### キーボードショートカット
- `Space`: 再生/一時停止
- `左/右矢印`: 10秒スキップ
- `上/下矢印`: 30秒スキップ
- `F`: フルスクリーン切り替え
- `M`: ミュート切り替え

### ファイル管理

#### ファイルの削除
- ファイルを**右クリック** → 「削除」を選択
- **コンテキストメニュー**: 右クリックでオプション表示
- **キーボード**: `Ctrl+W`で現在のファイルを削除
- **すべてクリア**: タブバーのゴミ箱ボタンを使用

#### ファイル情報
- **サムネイル**: すべてのファイルタイプで自動生成
- **ファイル名**: サムネイル下に表示
- **ファイルタイプ**: PDF、画像、動画を示すアイコン

## 🏗️ 技術アーキテクチャ

### コアコンポーネント

#### MediaManager
- 中央ファイル管理システム
- 永続化用IndexedDBストレージ
- ファイルメタデータと表示状態の管理
- UI更新用イベント駆動アーキテクチャ

#### ビューア
- **PDFViewer**: カスタムコントロール付きPDF.js統合
- **ImageViewer**: ズーム/パン機能付きCanvasベース画像レンダリング
- **VideoPlayer**: カスタムUIコントロール付きHTML5ビデオ

#### ストレージ
- **IndexedDB**: ファイルコンテンツとメタデータのストレージ
- **Service Worker**: キャッシュとオフライン機能
- **ローカル状態**: 表示位置と設定

### ファイルストレージ

ファイルは以下の構造でIndexedDBを使用してローカルに保存されます：

```javascript
// ファイルメタデータ
{
  id: "uuid",
  fileName: "document.pdf",
  mediaType: "pdf",
  fileSize: 1024000,
  importDate: "2024-01-01T00:00:00Z",
  thumbnailDataUrl: "data:image/jpeg;base64,...",
  
  // PDF固有
  pageCount: 10,
  lastViewedPage: 5,
  
  // 動画固有
  lastViewedTime: 120.5,
  videoDuration: 300.0
}

// ファイルデータ（パフォーマンス向上のため別ストア）
{
  id: "uuid",
  data: ArrayBuffer,
  type: "application/pdf",
  name: "document.pdf"
}
```

### PWA機能

#### Service Worker
- **キャッシュ戦略**: インストール時にコアファイルをキャッシュ
- **ランタイムキャッシュ**: 必要に応じて動的コンテンツをキャッシュ
- **オフラインサポート**: 初回読み込み後はインターネットなしで動作
- **バックグラウンド同期**: 接続復旧時にファイル操作を同期

#### ウェブアプリマニフェスト
- **インストール可能**: ネイティブアプリとしてインストール可能
- **アイコン**: 異なるデバイス用の複数サイズ
- **表示**: アプリライクな体験のためのスタンドアロンモード
- **ファイルハンドリング**: サポートされるファイルタイプとの関連付け

## 🛠️ 開発

### プロジェクト構造

```
Pink_Reader_PWA/
├── index.html              # メインアプリシェル
├── manifest.json           # PWAマニフェスト
├── sw.js                   # Service worker
├── css/
│   └── styles.css          # ピンクテーマスタイリング
├── js/
│   ├── app.js              # メインアプリケーションコントローラー
│   ├── media-manager.js    # ファイル管理システム
│   ├── pdf-viewer.js       # PDF表示コンポーネント
│   ├── image-viewer.js     # 画像表示コンポーネント
│   ├── video-player.js     # 動画再生コンポーネント
│   └── utils.js            # ユーティリティ関数
├── lib/                    # 外部ライブラリ（PDF.js）
├── icons/                  # PWAアイコン
└── README.md              # このファイル
```

### 依存関係

#### 外部ライブラリ
- **PDF.js 3.11.174**: PDFレンダリングエンジン
- **ブラウザAPI**: FileReader、Canvas、IndexedDB、Service Workers

#### モダンウェブ標準
- **ES6+ JavaScript**: クラス、async/await、モジュール
- **CSS Grid & Flexbox**: レスポンシブレイアウト
- **ウェブコンポーネント**: 該当する箇所でのカスタム要素
- **プログレッシブエンハンスメント**: 段階的機能向上

### ブラウザサポートマトリックス

| 機能 | Chrome | Firefox | Safari | Edge |
|------|--------|---------|--------|------|
| コアアプリ | ✅ 80+ | ✅ 75+ | ✅ 13+ | ✅ 80+ |
| Service Worker | ✅ | ✅ | ✅ | ✅ |
| IndexedDB | ✅ | ✅ | ✅ | ✅ |
| File System Access | ✅ 86+ | ❌ | ❌ | ✅ 86+ |
| Web Share | ✅ | ❌ | ✅ | ✅ |

### パフォーマンス最適化

#### 読み込み
- **プログレッシブローディング**: UIを即座に表示、必要に応じて機能を読み込み
- **コード分割**: モジュラーJavaScriptアーキテクチャ
- **リソースヒント**: 重要なリソースをプリロード
- **Service Worker**: インテリジェントキャッシュ戦略

#### ランタイム
- **仮想スクロール**: 大きなファイルリストの効率的な処理
- **サムネイルキャッシュ**: 一度生成して永続的に保存
- **デバウンス操作**: 滑らかなUI相互作用
- **メモリ管理**: 適切なクリーンアップと破棄

## 🔧 設定

### カスタマイズオプション

#### テーマカラー
`styles.css`のCSS変数を編集：

```css
:root {
  --color-primary: #FFEAEF;    /* ライトピンク背景 */
  --color-secondary: #FACCD9;  /* ミディアムピンクアクセント */
  --color-accent: #FF7BAC;     /* ブライトピンクハイライト */
  --color-text: #4D4D4D;       /* ダークグレーテキスト */
}
```

#### ファイルタイプサポート
新しいファイルタイプを追加するため`utils.js`を修正：

```javascript
static getMediaType(fileName) {
  const extension = fileName.toLowerCase().split('.').pop();
  
  // 新しい拡張子をここに追加
  const imageExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp', 'bmp', 'svg'];
  const videoExtensions = ['mp4', 'webm', 'ogg', 'mov', 'avi', 'mkv'];
  const pdfExtensions = ['pdf'];
  
  // ... メソッドの続き
}
```

#### キャッシュ設定
`sw.js`でService Workerキャッシュを調整：

```javascript
const CACHE_NAME = 'pink-reader-v1';          // キャッシュ無効化のためバージョン更新
const CORE_FILES = [ /* ... */ ];             // 即座にキャッシュするファイル
const EXTERNAL_DEPS = [ /* ... */ ];          // キャッシュする外部リソース
```

### 環境変数

これはクライアントサイドアプリですが、ビルド時変数を設定できます：

```javascript
// ビルドプロセス内で
const config = {
  API_BASE_URL: process.env.API_BASE_URL || '',
  VERSION: process.env.npm_package_version || '1.0.0',
  DEBUG: process.env.NODE_ENV === 'development'
};
```

## 🚀 デプロイメント

### 静的ホスティング

Pink Reader PWAは任意のウェブサーバーにデプロイできる静的ウェブアプリケーションです：

#### GitHub Pages
1. GitHubリポジトリにコードをプッシュ
2. リポジトリ設定でGitHub Pagesを有効化
3. ソースブランチを選択（通常`main`または`gh-pages`）
4. `https://username.github.io/repository-name`でアクセス

#### Netlify
1. GitHubリポジトリをNetlifyに接続
2. ビルドコマンドを設定：（静的サイトには不要）
3. 公開ディレクトリを設定：`./`（ルート）
4. gitプッシュで自動デプロイ

#### Vercel
1. GitHubリポジトリをVercelにインポート
2. ビルド設定は不要
3. ゼロ設定でデプロイ

#### Firebase Hosting
```bash
npm install -g firebase-tools
firebase init hosting
firebase deploy
```

#### Apache/Nginx
すべてのファイルをウェブサーバーのドキュメントルートにコピーするだけ。

### HTTPS要件

PWA機能には本番環境でHTTPSが必要です：
- Service WorkerはHTTPS上でのみ動作
- File System Access APIはセキュアコンテキストが必要
- インストールプロンプトにはHTTPSが必要

ほとんどのホスティングプロバイダーは無料のSSL証明書を提供しています。

### CDN設定

最適なパフォーマンスのため、CDNを設定：

```nginx
# 静的アセットをキャッシュ
location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}

# HTMLを短い有効期限でキャッシュ
location ~* \.html$ {
    expires 1h;
    add_header Cache-Control "public";
}

# Service workerはキャッシュしない
location = /sw.js {
    expires 0;
    add_header Cache-Control "no-cache, no-store, must-revalidate";
}
```

## 🐛 トラブルシューティング

### よくある問題

#### 「PDFの読み込みに失敗しました」
- **原因**: 大きなPDFファイルまたはメモリ制約
- **解決策**: PDFファイルサイズを縮小するかページを更新
- **予防策**: 大きなファイル用のPDFストリーミングを実装

#### 「画像がズームしない」
- **原因**: モバイルでのタッチイベント競合
- **解決策**: ダブルタップでズームまたはズームボタンを使用
- **予防策**: タッチイベントが適切に処理されることを確認

#### 「動画が再生されない」
- **原因**: サポートされていない動画コーデック
- **解決策**: 動画をMP4/WebM形式に変換
- **予防策**: コーデック検出とユーザーフィードバックを追加

#### 「ブラウザ再起動後にファイルが消える」
- **原因**: ブラウザによるIndexedDBデータのクリア
- **解決策**: ブラウザストレージ設定またはシークレットモード
- **予防策**: エクスポート/インポート機能を実装

#### 「アプリがインストールできない」
- **原因**: PWAマニフェストの問題またはHTTPS要件
- **解決策**: ブラウザコンソールでマニフェストエラーをチェック
- **予防策**: manifest.jsonを検証してHTTPS上で配信

### パフォーマンス問題

#### ファイル読み込みが遅い
1. ファイルサイズをチェック（>100MBは問題を引き起こす可能性）
2. Service Workerがアクティブか確認
3. ブラウザキャッシュをクリアしてリロード
4. 利用可能なデバイスストレージをチェック

#### メモリ使用量が多い
1. 未使用のファイルタブを閉じる
2. アプリケーションを再起動
3. 可能な限り小さなファイルを使用
4. 持続する場合はブラウザデータをクリア

### ブラウザ固有の問題

#### Safari iOS
- 古いバージョンではファイルピッカーが動作しない可能性
- 代わりにドラッグ&ドロップを使用
- 完全な互換性にはiOS 13+を確保

#### Firefox
- 一部の動画コーデックがサポートされない可能性
- 動画をWebM形式に変換
- ブラウザ設定でハードウェアアクセラレーションを有効化

## 📱 モバイル使用

### モバイルでのインストール

#### iOS（Safari）
1. SafariでPink Reader PWAにアクセス
2. 共有ボタン（□↑）をタップ
3. 「ホーム画面に追加」を選択
4. インストールを確認

#### Android（Chrome）
1. ChromeでPink Reader PWAにアクセス
2. メニュー（⋮）をタップ
3. 「ホーム画面に追加」を選択
4. またはインストールプロンプトバナーを使用

### モバイル最適化

#### タッチジェスチャー
- **ピンチズーム**: 画像とPDF
- **ダブルタップ**: クイックズーム切り替え
- **長押し**: コンテキストメニュー
- **スワイプ**: ページナビゲート（PDF）

#### レスポンシブデザイン
- **モバイルファースト**: 小画面向けに最適化
- **タッチターゲット**: ボタンの最小サイズ44px
- **読みやすいテキスト**: 適切なフォントサイズ
- **サイドバー**: モバイルで折りたたみ可能

## 🔒 プライバシー&セキュリティ

### データストレージ
- **ローカルのみ**: すべてのファイルはデバイスにローカル保存
- **クラウドなし**: 外部サーバーにデータ送信なし
- **プライベート**: ファイルはデバイスから離れることなし
- **暗号化**: 利用可能な場合はブラウザストレージで暗号化使用

### 権限
- **ファイルアクセス**: 明示的にインポートしたファイルのみ
- **ストレージ**: ローカルブラウザストレージのみ
- **ネットワーク**: 外部依存関係（PDF.js）の読み込みのみ
- **位置情報**: アクセスなし
- **カメラ/マイク**: アクセスなし

### セキュリティ機能
- **コンテンツセキュリティポリシー**: XSS攻撃を防止
- **HTTPS専用**: 本番環境ではセキュアな接続が必要
- **同一オリジン**: 外部リソース読み込みを制限
- **入力検証**: すべてのユーザー入力をサニタイズ

## 🤝 貢献

### 開発セットアップ

1. **リポジトリをクローン**
   ```bash
   git clone https://github.com/your-username/pink-reader-pwa.git
   cd pink-reader-pwa
   ```

2. **開発サーバーを起動**
   ```bash
   python -m http.server 8000
   # または
   npx http-server -p 8000
   ```

3. **ブラウザで開く**
   ```
   http://localhost:8000
   ```

### コードスタイル

- **JavaScript**: ES6+機能、promiseよりasync/await
- **CSS**: モバイルファーストレスポンシブデザイン、CSS Grid/Flexbox
- **HTML**: セマンティックマークアップ、アクセシビリティを考慮
- **コメント**: 関数にはJSDocスタイル、複雑なロジックにはインライン

### テスト

#### 手動テストチェックリスト
- [ ] PDF、画像、動画ファイルをインポート
- [ ] タブとサイドバーを使用してファイル間をナビゲート
- [ ] ズームとパン機能をテスト
- [ ] 動画再生と位置保存を確認
- [ ] モバイルデバイス（iOS/Android）でテスト
- [ ] PWAインストールが動作することを確認
- [ ] オフライン機能をテスト

#### ブラウザテスト
複数のブラウザでテスト：
- Chrome/Chromium（主要）
- Firefox
- Safari（利用可能な場合）
- Edge

### プルリクエストプロセス

1. リポジトリをフォーク
2. 機能ブランチを作成（`git checkout -b feature/new-feature`）
3. テスト付きで変更を実行
4. 変更をコミット（`git commit -am 'Add new feature'`）
5. ブランチにプッシュ（`git push origin feature/new-feature`）
6. プルリクエストを作成

## 📄 ライセンス

MITライセンス - 詳細はLICENSEファイルを参照。

## 🙏 謝辞

- **オリジナルiOSアプリ**: デザインと機能のインスピレーション
- **PDF.js**: MozillaのすばらしいPDFレンダリングライブラリ
- **モダンウェブ標準**: PWAを可能にする技術
- **オープンソースコミュニティ**: ツールとインスピレーション

## 📞 サポート

### ヘルプの取得
- **Issue**: GitHub Issuesでバグを報告
- **ディスカッション**: GitHub Discussionsで質問
- **ドキュメント**: このREADMEとインラインコードコメント

### 既知の制限事項
- **大きなファイル**: 500MB超のファイルはパフォーマンス問題を引き起こす可能性
- **ファイルシステム**: 完全なファイルシステムアクセスはChromiumブラウザに限定
- **コーデックサポート**: 動画/音声コーデックはブラウザサポートに依存
- **iOS Safari**: 他のブラウザと比べて一部のPWA機能が制限

---

**Pink Reader PWA** - モダンなウェブ技術で構築された美しいクロスプラットフォームメディアリーダー。🌸

*ウェブへの❤️を込めて作成*